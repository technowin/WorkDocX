{% extends "bootstrap/vertical_base.html" %}
{% load static i18n %}

{% block title %}{% trans "CRM" %}{% endblock title %}

{% block page_title %}
    {% include "bootstrap/partials/page-title.html" with page_title='CRM' sub_title='Dashboard' %}
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-6 col-xl-3">
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-6">
                            <h5 class="text-muted fw-normal mt-0 text-truncate"
                                title="{{ statistics.campaign.title }}">{{ statistics.campaign.title }}</h5>
                            <h3 class="my-2 py-1">{{ statistics.campaign.number }}</h3>
                            <p class="mb-0 text-muted">
                                <span class="text-{{ statistics.campaign.color }} me-2"><i
                                        class="mdi {{ statistics.campaign.icon }}"></i> {{ statistics.campaign.growth }}%</span>
                            </p>
                        </div>
                        <div class="col-6">
                            <div class="text-end">
                                <div id="campaign-sent-chart" data-colors="#727cf5"></div>
                            </div>
                        </div>
                    </div> <!-- end row-->
                </div> <!-- end card-body -->
            </div> <!-- end card -->
        </div> <!-- end col -->

        <div class="col-md-6 col-xl-3">
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-6">
                            <h5 class="text-muted fw-normal mt-0 text-truncate"
                                title="{{ statistics.leads.title }}">{{ statistics.leads.title }}</h5>
                            <h3 class="my-2 py-1">{{ statistics.leads.number }}</h3>
                            <p class="mb-0 text-muted">
                                <span class="text-{{ statistics.leads.color }} me-2"><i
                                        class="mdi {{ statistics.leads.icon }}"></i> {{ statistics.leads.growth }}%</span>
                            </p>
                        </div>
                        <div class="col-6">
                            <div class="text-end">
                                <div id="new-leads-chart" data-colors="#0acf97"></div>
                            </div>
                        </div>
                    </div> <!-- end row-->
                </div> <!-- end card-body -->
            </div> <!-- end card -->
        </div> <!-- end col -->

        <div class="col-md-6 col-xl-3">
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-6">
                            <h5 class="text-muted fw-normal mt-0 text-truncate"
                                title="{{ statistics.deals.title }}">{{ statistics.deals.title }}</h5>
                            <h3 class="my-2 py-1">{{ statistics.deals.number }}</h3>
                            <p class="mb-0 text-muted">
                                <span class="text-{{ statistics.deals.color }} me-2"><i
                                        class="mdi {{ statistics.deals.icon }}"></i> {{ statistics.deals.growth }}%</span>
                            </p>
                        </div>
                        <div class="col-6">
                            <div class="text-end">
                                <div id="deals-chart" data-colors="#727cf5"></div>
                            </div>
                        </div>
                    </div> <!-- end row-->
                </div> <!-- end card-body -->
            </div> <!-- end card -->
        </div> <!-- end col -->

        <div class="col-md-6 col-xl-3">
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-6">
                            <h5 class="text-muted fw-normal mt-0 text-truncate"
                                title="{{ statistics.revenue.title }}">{{ statistics.revenue.title }}</h5>
                            <h3 class="my-2 py-1">${{ statistics.revenue.number }}k</h3>
                            <p class="mb-0 text-muted">
                                <span class="text-{{ statistics.revenue.color }} me-2"><i
                                        class="mdi {{ statistics.revenue.icon }}"></i> {{ statistics.revenue.growth }}%</span>
                            </p>
                        </div>
                        <div class="col-6">
                            <div class="text-end">
                                <div id="booked-revenue-chart" data-colors="#0acf97"></div>
                            </div>
                        </div>
                    </div> <!-- end row-->
                </div> <!-- end card-body -->
            </div> <!-- end card -->
        </div> <!-- end col -->
    </div>
    <!-- end row -->

    <div class="row">
        <div class="col-lg-5">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="header-title">Campaigns</h4>
                    <div class="dropdown">
                        <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown"
                           aria-expanded="false">
                            <i class="mdi mdi-dots-vertical"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Today</a>
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Yesterday</a>
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Last Week</a>
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Last Month</a>
                        </div>
                    </div>
                </div>

                <div class="card-body pt-0">
                    <div id="dash-campaigns-chart" class="apex-charts" data-colors="#ffbc00,#727cf5,#0acf97"></div>

                    <div class="row text-center mt-3">
                        <div class="col-sm-4">
                            <i class="mdi {{ campaign_stat.sent.icon }} widget-icon rounded-circle bg-{{ campaign_stat.sent.color }}-lighten text-{{ campaign_stat.sent.color }}"></i>
                            <h3 class="fw-normal mt-3">
                                <span>{{ campaign_stat.sent.data }}</span>
                            </h3>
                            <p class="text-muted mb-0 mb-2"><i
                                    class="mdi mdi-checkbox-blank-circle text-{{ campaign_stat.sent.color }}"></i>
                                {{ campaign_stat.sent.title }}</p>
                        </div>
                        <div class="col-sm-4">
                            <i class="mdi {{ campaign_stat.reached.icon }} widget-icon rounded-circle bg-{{ campaign_stat.reached.color }}-lighten text-{{ campaign_stat.reached.color }}"></i>
                            <h3 class="fw-normal mt-3">
                                <span>{{ campaign_stat.reached.data }}</span>
                            </h3>
                            <p class="text-muted mb-0 mb-2"><i
                                    class="mdi mdi-checkbox-blank-circle text-{{ campaign_stat.reached.color }}"></i>
                                {{ campaign_stat.reached.title }}</p>
                        </div>
                        <div class="col-sm-4">
                            <i class="mdi {{ campaign_stat.opened.icon }} widget-icon rounded-circle bg-{{ campaign_stat.opened.color }}-lighten text-{{ campaign_stat.opened.color }}"></i>
                            <h3 class="fw-normal mt-3">
                                <span>{{ campaign_stat.opened.data }}</span>
                            </h3>
                            <p class="text-muted mb-0 mb-2"><i
                                    class="mdi mdi-checkbox-blank-circle text-{{ campaign_stat.opened.color }}"></i>
                                {{ campaign_stat.opened.title }}</p>
                        </div>
                    </div>
                </div>
                <!-- end card body-->
            </div>
            <!-- end card -->
        </div>
        <!-- end col-->

        <div class="col-lg-7">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="header-title">Revenue</h4>
                    <div>
                        <button type="button" class="btn btn-soft-secondary btn-sm">
                            ALL
                        </button>
                        <button type="button" class="btn btn-soft-primary btn-sm">
                            1M
                        </button>
                        <button type="button" class="btn btn-soft-secondary btn-sm">
                            6M
                        </button>
                        <button type="button" class="btn btn-soft-secondary btn-sm">
                            1Y
                        </button>
                    </div>
                </div>

                <div class="card-body pt-0">
                    <div class="chart-content-bg">
                        <div class="row text-center">
                            <div class="col-sm-6">
                                <p class="text-muted mb-0 mt-3">Current Month</p>
                                <h2 class="fw-normal mb-3">
                                    <span>{{ revenue_stat_data.current_month_total }}</span>
                                </h2>
                            </div>
                            <div class="col-sm-6">
                                <p class="text-muted mb-0 mt-3">Previous Month</p>
                                <h2 class="fw-normal mb-3">
                                    <span>{{ revenue_stat_data.previous_month_total }}</span>
                                </h2>
                            </div>
                        </div>
                    </div>

                    <div dir="ltr">
                        <div id="dash-revenue-chart" class="apex-charts" data-colors="#0acf97,#fa5c7c"></div>
                    </div>

                </div>
                <!-- end card body-->
            </div>
            <!-- end card -->
        </div>
        <!-- end col-->
    </div>
    <!-- end row-->


    <div class="row">
        <div class="col-xl-4 col-lg-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="header-title">Top Performing</h4>
                    <div class="dropdown">
                        <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown"
                           aria-expanded="false">
                            <i class="mdi mdi-dots-vertical"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Settings</a>
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Action</a>
                        </div>
                    </div>
                </div>

                <div class="card-body pt-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-sm table-nowrap table-centered mb-0">
                            <thead>
                            <tr>
                                <th>User</th>
                                <th>Leads</th>
                                <th>Deals</th>
                                <th>Tasks</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for user in topPerforming %}
                                <tr>
                                    <td>
                                        <h5 class="font-15 mb-1 fw-normal">{{ user.name }}</h5>
                                        <span class="text-muted font-13">{{ user.role }}</span>
                                    </td>
                                    <td>{{ user.leads }}</td>
                                    <td>{{ user.deals }}</td>
                                    <td>{{ user.tasks }}</td>
                                    <td class="table-action">
                                        <a href="javascript: void(0);" class="action-icon"> <i class="mdi mdi-eye"></i></a>
                                    </td>
                                </tr>
                            {% endfor %}

                            </tbody>
                        </table>
                    </div> <!-- end table-responsive-->

                </div> <!-- end card-body-->
            </div> <!-- end card-->
        </div>
        <!-- end col-->

        <div class="col-xl-4 col-lg-6">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="header-title">Recent Leads</h4>
                    <div class="dropdown">
                        <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown"
                           aria-expanded="false">
                            <i class="mdi mdi-dots-vertical"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Settings</a>
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Action</a>
                        </div>
                    </div>
                </div>

                <div class="card-body pt-2">
                    {% for user in recentLeads %}
                        <div class="d-flex align-items-start {% if forloop.first %}mt-0{% else %}mt-3{% endif %}">
                            <img class="me-3 rounded-circle" src="{{ user.avatar }}" width="40"
                                 alt="Generic placeholder image">
                            <div class="w-100 overflow-hidden">
                                <span class="badge badge-{{ user.color }}-lighten float-end">{{ user.result }}</span>
                                <h5 class="mt-0 mb-1">{{ user.name }}</h5>
                                <span class="font-13">{{ user.email }}</span>
                            </div>
                        </div>
                    {% endfor %}

                </div>
                <!-- end card-body -->
            </div>
            <!-- end card-->
        </div>
        <!-- end col -->

        <div class="col-xl-4 col-lg-6">
            <div class="card cta-box bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex align-items-start align-items-center">
                        <div class="w-100 overflow-hidden">
                            <h2 class="mt-0 text-reset"><i class="mdi mdi-bullhorn-outline"></i>&nbsp;</h2>
                            <h3 class="m-0 fw-normal cta-box-title text-reset">Enhance your <b>Campaign</b> for better
                                outreach <i class="mdi mdi-arrow-right"></i></h3>
                        </div>
                        <img class="ms-3" src="{% static 'images/svg/email-campaign.svg' %}" width="120"
                             alt="Generic placeholder image">
                    </div>
                </div>
                <!-- end card-body -->
            </div>
            <!-- end card-->

            <!-- Todo-->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="header-title">Todo</h4>
                    <div class="dropdown float-end">
                        <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown"
                           aria-expanded="false">
                            <i class="mdi mdi-dots-vertical"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Settings</a>
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Action</a>
                        </div>
                    </div>
                </div>

                <div class="todoapp mt-n2">
                    <div class="card-body py-0 mb-2" data-simplebar style="max-height: 243px">
                        <ul class="list-group list-group-flush todo-list" id="todo-list"></ul>
                    </div>
                </div> <!-- end .todoapp-->
            </div> <!-- end card-->

        </div>
        <!-- end col -->
    </div>
    <!-- end row-->
{% endblock %}

{% block extra_javascript %}
    <!-- Apex  Charts js -->
    <script src="{% static 'js/vendor/apexcharts.min.js' %}"></script>

    <!-- Todo js -->
    <script src="{% static 'js/ui/component.todo.js' %}"></script>

    <script>

        var campaignSentData = JSON.parse('{{campaign_sent_chart | safe}}')
        var newLeadsData = JSON.parse('{{new_leads_chart}}')
        var dealsData = JSON.parse('{{deals_chart | safe}}')
        var bookedRevenueData = JSON.parse('{{booked_revenue_chart|safe}}')
        var campaignsData = JSON.parse("{{campaigns_chart}}");
        var revenueData = JSON.parse("{{revenue_chart|escapejs}}")

        //
        // Campaign Sent Chart
        //
        var colors = ["#727cf5", "#0acf97", "#fa5c7c", "#ffbc00"];
        var dataColors = $("#campaign-sent-chart").data('colors');
        if (dataColors) {
            colors = dataColors.split(",");
        }
        var options1 = {
            chart: {
                type: 'bar',
                height: 60,
                sparkline: {
                    enabled: true
                }
            },
            plotOptions: {
                bar: {
                    columnWidth: '60%'
                }
            },
            colors: colors,
            series: [{
                data: Object.values(campaignSentData)
            }],
            labels: Object.keys(campaignSentData),
            xaxis: {
                crosshairs: {
                    width: 1
                },
            },
            tooltip: {
                fixed: {
                    enabled: false
                },
                x: {
                    show: false
                },
                y: {
                    title: {
                        formatter: function (seriesName) {
                            return ''
                        }
                    }
                },
                marker: {
                    show: false
                }
            }
        }

        new ApexCharts(document.querySelector("#campaign-sent-chart"), options1).render();


        //
        // New Leads Chart
        //
        var colors = ["#727cf5", "#0acf97", "#fa5c7c", "#ffbc00"];
        var dataColors = $("#new-leads-chart").data('colors');
        if (dataColors) {
            colors = dataColors.split(",");
        }
        var options2 = {
            chart: {
                type: 'line',
                height: 60,
                sparkline: {
                    enabled: true
                }
            },
            series: [{
                data: newLeadsData
            }],
            stroke: {
                width: 2,
                curve: 'smooth'
            },
            markers: {
                size: 0
            },
            colors: colors,
            tooltip: {
                fixed: {
                    enabled: false
                },
                x: {
                    show: false
                },
                y: {
                    title: {
                        formatter: function (seriesName) {
                            return ''
                        }
                    }
                },
                marker: {
                    show: false
                }
            }
        }


        new ApexCharts(document.querySelector("#new-leads-chart"), options2).render();


        //
        // Deals Charts
        //
        var colors = ["#727cf5", "#0acf97", "#fa5c7c", "#ffbc00"];
        var dataColors = $("#deals-chart").data('colors');
        if (dataColors) {
            colors = dataColors.split(",");
        }
        var options3 = {
            chart: {
                type: 'bar',
                height: 60,
                sparkline: {
                    enabled: true
                }
            },
            plotOptions: {
                bar: {
                    columnWidth: '60%'
                }
            },
            colors: colors,
            series: [{
                data: Object.values(dealsData)
            }],
            labels: Object.values(dealsData),
            xaxis: {
                crosshairs: {
                    width: 1
                },
            },
            tooltip: {
                fixed: {
                    enabled: false
                },
                x: {
                    show: false
                },
                y: {
                    title: {
                        formatter: function (seriesName) {
                            return ''
                        }
                    }
                },
                marker: {
                    show: false
                }
            }
        }


        new ApexCharts(document.querySelector("#deals-chart"), options3).render();

        //
        // Booked Revenue Chart
        //
        var colors = ["#727cf5", "#0acf97", "#fa5c7c", "#ffbc00"];
        var dataColors = $("#booked-revenue-chart").data('colors');
        if (dataColors) {
            colors = dataColors.split(",");
        }
        var options4 = {
            chart: {
                type: 'bar',
                height: 60,
                sparkline: {
                    enabled: true
                }
            },
            plotOptions: {
                bar: {
                    columnWidth: '60%'
                }
            },
            colors: colors,
            series: [{
                data:Object.values(bookedRevenueData)
            }],
            labels: Object.keys(bookedRevenueData),
            xaxis: {
                crosshairs: {
                    width: 1
                },
            },
            tooltip: {
                fixed: {
                    enabled: false
                },
                x: {
                    show: false
                },
                y: {
                    title: {
                        formatter: function (seriesName) {
                            return ''
                        }
                    }
                },
                marker: {
                    show: false
                }
            }
        }

        new ApexCharts(document.querySelector("#booked-revenue-chart"), options4).render();


        //
        // CAMPAIGNS RADIALBARS CHART
        //
        var colors = ["#727cf5", "#0acf97", "#fa5c7c", "#ffbc00"];
        var dataColors = $("#dash-campaigns-chart").data('colors');
        if (dataColors) {
            colors = dataColors.split(",");
        }
        var options = {
            chart: {
                height: 314,
                type: 'radialBar'
            },
            colors: colors,
            series: campaignsData,
            labels: ['Total Sent', 'Reached', 'Opened'],
            plotOptions: {
                radialBar: {
                    track: {
                        margin: 8,
                    }
                }
            }
        }

        var chart = new ApexCharts(
            document.querySelector("#dash-campaigns-chart"),
            options
        );

        chart.render();


        //
        // REVENUE AREA CHART
        //

        var colors = ["#727cf5", "#0acf97", "#fa5c7c", "#ffbc00"];
        var dataColors = $("#dash-revenue-chart").data('colors');
        if (dataColors) {
            colors = dataColors.split(",");
        }
        var options = {
            chart: {
                height: 338,
                type: 'line',
                toolbar: {
                    show: false
                }
            },
            stroke: {
                curve: 'smooth',
                width: 2
            },
            series: [{
                name: 'Total Revenue',
                type: 'area',
                data: revenueData['revenue']
            }, {
                name: 'Total Pipeline',
                type: 'line',
                data: revenueData['pipeline']
            }],
            fill: {
                type: 'solid',
                opacity: [0.35, 1],
            },
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            markers: {
                size: 0
            },
            colors: colors,
            yaxis: [
                {
                    title: {
                        text: 'Revenue (USD)',
                    },
                    min: 0
                }
            ],
            tooltip: {
                shared: true,
                intersect: false,
                y: {
                    formatter: function (y) {
                        if (typeof y !== "undefined") {
                            return y.toFixed(0) + "k";
                        }
                        return y;

                    }
                }
            },
            grid: {
                borderColor: '#f1f3fa',
                padding: {
                    bottom: 5
                }
            },
            legend: {
                fontSize: '14px',
                fontFamily: '14px',
                offsetY: 5,
            },
            responsive: [{
                breakpoint: 600,
                options: {
                    yaxis: {
                        show: false
                    },
                    legend: {
                        show: false
                    }
                }
            }]
        }

        var chart = new ApexCharts(
            document.querySelector("#dash-revenue-chart"),
            options
        );

        chart.render();
    </script>

    {% comment %}<script src="{% static 'js/pages/demo.crm-dashboard.js' %}"></script>{% endcomment %}

{% endblock %}